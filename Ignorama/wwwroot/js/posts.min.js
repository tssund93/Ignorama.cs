function slideOut(){$("#quickreply").stop(!0).animate({bottom:-1},200).attr("class","slid-out")}function slideIn(){$("#quickreply").animate({bottom:-222},200).delay(200).queue(function(n){$(this).attr("class","slid-in");n()})}function slide(){$("#quickreply").hasClass("slid-out")?slideIn():slideOut()}function escapeHTML(n){return escape.textContent=n,escape.innerHTML}function unescapeHTML(n){return escape.innerHTML=n,escape.textContent}function updateFilename(){temp=$("#upload").val().split(".");extension=temp[temp.length-1];$("#filename").val(window.performance.now().toString().replace(".","")+"."+extension);document.getElementById("submitbutton").disabled=!0;$("#uploadsubmit").click()}var threadID=function(){var n=window.location.href.replace(/\/$/,"");return n.substr(n.lastIndexOf("/")+1).replace(/#.*$/,"")}(),postsVue=new Vue({el:"main",data:{posts:[],page:1,perPage:20},computed:{visiblePosts:function(){var n=(this.page-1)*this.perPage;return this.posts.slice(n,n+this.perPage)}},created:function(){this.getPosts(threadID,this.updatePage)},filters:{date:function(n){return n?(n=new Date(n),n.toLocaleString()):""},formatPost:function(n){return n=escapeHTML(n),n=n.replace(/\n/g,"<br>"),n=n.replace(/\[img\](.*?)\[\/img\]/gi,'<a target="_blank" href="$1"><img href="$1" src="$1" class="img img-responsive" style="max-height: 480px;"><\/img><\/a>'),n=n.replace(/\[webm\](.*?)\[\/webm\]/gi,'<video preload="none" controls="controls" class="img img-responsive"><source type="video/webm" src="$1"><\/video>'),n=n.replace(/\[i\]([\s\S]*?)\[\/i\]/ig,"<i>$1<\/i>"),n=n.replace(/\[b\]([\s\S]*?)\[\/b\]/ig,"<b>$1<\/b>"),n=n.replace(/\[u\]([\s\S]*?)\[\/u\]/ig,"<u>$1<\/u>"),n=n.replace(/\[spoiler\]([\s\S]*?)\[\/spoiler\]/ig,"<span class='spoiler'>$1<\/span>"),n=n.replace(/\[reply post=([0-9]+) user=(.*?)\]\s*\[\/reply\]/ig,"<a href='javascript:viewPost($1);'><b>$2<\/b><\/a>"),n=n.replace(/\[reply user=(.*?) post=([0-9]+)\]\s*\[\/reply\]/gi,"<a href='javascript:viewPost($2);'><b>$1<\/b><\/a>"),n=n.replace(/\[reply post=([0-9]+) user=(.*?)\]\s*([\s\S]*?)\s*\[\/reply\]\s?/ig,"<div style='padding: 5px;border: 1px solid #DDD;background-color:#F5F5F5'><b><a href='javascript:viewPost($1);'>$2<\/a> said:<\/b><br/>$3<\/div>"),n=n.replace(/\[reply user=(.*?) post=([0-9]+)\]\s*([\s\S]*?)\s*\[\/reply\]\s?/ig,"<div style='padding: 5px;border: 1px solid #DDD;background-color:#F5F5F5'><b><a href='javascript:viewPost($2);'>$1<\/a> said:<\/b><br/>$3<\/div>"),n=n.replace(/\[reply[=| ]([0-9]+)\]\s*([\s\S]*?)\s*\[\/reply\]\s?/ig,"<div style='padding: 5px;border: 1px solid #DDD;background-color:#F5F5F5'><b><a href='javascript:viewPost($1);'>$1<\/a> said:<\/b><br/>$2<\/div>"),n=n.replace(/\[quote\]\s?([\s\S]*?)\s?\[\/quote\]\s?/ig,"<div style='padding: 5px;border: 1px solid #DDD;background-color:#F5F5F5'><b>Quote:<\/b><br/>$1<\/div>"),n=n.replace(/\[code\]\s*([\s\S]*?)\s*\[\/code\]/ig,"<pre><code>$1<\/code><\/pre>"),n=n.replace(/\[color=(.*?)\]([\s\S]*?)\[\/color\]/ig,"<span style='color:$1'>$2<\/span>"),n=n.replace(/\[url=(http(s?):\/\/)?(.*?)\](.*?)\[\/url\]/ig,"<a target='_blank' href='http$2://$3'>$4<\/a>"),n.replace(/[a-zA-Z\/\/:\.]*(youtube.com\/watch\?v=|youtu.be\/)([a-zA-Z0-9\-_]+)([a-zA-Z0-9\/\*\-\_\?\&\;\%\=\.]*)/gi,'<div class=\'flex-video widescreen\'><iframe width="560" height="315" src="//www.youtube.com/embed/$2" frameborder="0" allowfullscreen><\/iframe><\/div>')}},watch:{visiblePosts:function(n){var t=Math.max(...n.map(n=>n.ID));this.follow(threadID,t)}},methods:{getPosts:function(n,t){axios.get("/Threads/GetPosts/"+n).then(n=>{this.posts=n.data,t&&t()})},follow:function(n,t){axios.post("/Threads/Follow",{ThreadID:n,LastSeenPostID:t}).then(n=>{console.log("Followed thread "+n.data)}).catch(n=>{console.error("Error following thread: "+n)})},updatePage:function(){if(lastSeenPostID!==""){var t=parseInt(lastSeenPostID),n=Math.ceil((this.posts.findIndex(n=>n.ID>t)+1)/this.perPage);this.page=n!==0?n:Math.ceil(this.posts.length/this.perPage)}},reply:function(n){var t=n.Text.replace(/\s*(\[reply.*?\][\s\S]+\[\/reply\]|\[quote\][\s\S]*\[\/quote\])\s*/gi,"");$("#postfield").val("[reply user="+n.User.UserName+" post="+n.ID+"]\n"+t+"\n[/reply]");slideOut()}}}),escape;$("#postform").submit(function(n){n.preventDefault();$.ajax({url:"/Posts/New/"+threadID,type:"post",data:$("#postform").serialize(),success:function(){$("#postfield").val("");$("input[name=Bump]").prop("checked",!1);$("input[name=Anonymous]").prop("checked",!1);$("input[name=RevealOP]").prop("checked",!1);slide();postsVue.getPosts(threadID,()=>postsVue.page=Math.ceil((postsVue.posts.length+1)/postsVue.perPage))},error:function(n,t){console.log($("#postform").serialize());alert("Unable to submit reply: "+t)}})});escape=document.createElement("textarea");$(document).ready(function(){$(function(){$("#uploadForm").submit(function(){var i,n;$('<input type="hidden" name="javascript" value="yes" />').appendTo($(this));i="iframeUpload";n=$('<iframe id="uploadframe" name="'+i+'" src="about:blank" />');n.css("display","none");$("body").append(n);$(this).attr({action:"/Home/UploadFile",method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data",target:i});var r=0,u=60,t=document.getElementById("postfield").value,f=t+" Uploading file",e=setInterval(function(){var i=document.getElementById("uploadframe").contentWindow.error,o,s;typeof i!="undefined"||r>u?(r>u&&(document.getElementById("postfield").value=t,alert("Upload timed out.  Your file is probably too big. (Max: 10 MB)"),document.getElementById("submitbutton").disabled=!1),document.getElementById("postfield").value=t,clearInterval(e),n.remove(),document.getElementById("submitbutton").disabled=!1):(document.getElementById("postfield").value=f+".",f=document.getElementById("postfield").value);$('input[name="javascript"]').remove();inputLength=0;inputLength+=$('input[name="file"]').val().length;0<inputLength&&i==="none"?($('input[name="file"]').val(""),document.getElementById("postfield").value=t,temp=$("#filename").val().split("."),extension=temp[temp.length-1],document.getElementById("postfield").value+=extension==="webm"?"[webm]"+window.location.origin+"/uploads/"+$("#filename").val()+"[/webm]":"[img]"+window.location.origin+"/uploads/"+$("#filename").val()+"[/img]",o=$("#postfield"),s=o.val().length,o[0].focus(),o[0].setSelectionRange(s,s),document.getElementById("submitbutton").disabled=!1):i!=="none"&&typeof i!="undefined"&&(alert(i),document.getElementById("submitbutton").disabled=!1);r++},1e3)})})});