@model IEnumerable<Ignorama.Models.Tag>
@{
    ViewData["Title"] = "Ignorama";
}

<div class="row dropdown">
    <div class="col-xs-12 above-threads">
        <a class="btn btn-default btn-sm threads" asp-controller="Threads" asp-action="New">New Thread</a>
        <div class="right-dropdown">
            <a class="dropdown-toggle btn btn-default btn-sm" data-toggle=dropdown>
                Boards <b class=caret>
                </b>
            </a>
            <ul class="dropdown-menu dropdown-menu-form pull-right boards" role=menu>
                <li v-for="tag in tags">
                    <label>
                        <input v-model="selectedTags" type=checkbox :value=tag.ID :checked="selectedTags.includes(tag.ID)" v-on:change="updateSelectedTag(tag)">{{ tag.Name }}
                    </label>
                </li>
            </ul>
        </div>
        <div class="right-dropdown">
            <a class="dropdown-toggle btn btn-default btn-sm" data-toggle=dropdown>
                <b class="glyphicon glyphicon-search"></b> <b class=caret></b>
            </a>
            <ul class="dropdown-menu dropdown-menu-form searchmenu pull-right">
                <li>
                    <input class=searchbox name=search type=text placeholder="Search" v-model="search">
                </li>
            </ul>
        </div>
    </div>
</div>
<ul class="tabs nav navbar-nav">
    <li class="nav-item">
        <a class="nav-link" v-on:click.prevent="view = ''" href="#" v-bind:class="{ active: view === '' }">All</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" v-on:click.prevent="view = 'following'" href="#" v-bind:class="{ active: view === 'following' }">Following</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" v-on:click.prevent="view = 'hidden'" href="#" v-bind:class="{ active: view === 'hidden' }">Hidden</a>
    </li>
</ul>

<div class="row" v-if="!threads.length">
    <div class="col-xs-12 thread loading">
        <img src="~/loading.png" />
    </div>
</div>
<div class="row" v-else-if="!visibleThreads.length" v-cloak>
    <div class="col-xs-12 thread">
        Nothing to see here!
    </div>
</div>
<div v-else class="row" v-for="thread in visibleThreads">
    <div class="col-xs-12 thread" :class="{ newposts: thread.Following && thread.LastSeenPostID < thread.LastPost.ID }" v-cloak>
        <div class="btn-group thread-dropdown">
            <a class="btn btn-default btn-xs dropdown-toggle" data-toggle=dropdown>
                <span class=caret>
                </span>
            </a>
            <ul class="dropdown-menu pull-right">
                <li>
                    <a v-if="thread.Hidden" href="#" v-on:click.prevent="toggleHidden(thread)">
                        Unhide thread
                    </a>
                    <a v-else href="#" v-on:click.prevent="toggleHidden(thread)">
                        Hide thread
                    </a>
                </li>
                <li v-if="thread.UserRoles.includes('Moderator')">
                    <a v-if="thread.Stickied" href="#" v-on:click.prevent="toggleStickied(thread)">
                        Unsticky thread
                    </a>
                    <a v-else href="#" v-on:click.prevent="toggleStickied(thread)">
                        Sticky thread
                    </a>
                </li>
                <li v-if="thread.UserRoles.includes('Moderator')">
                    <a v-if="thread.Locked" href="#" v-on:click.prevent="toggleLocked(thread)">
                        Unlock thread
                    </a>
                    <a v-else href="#" v-on:click.prevent="toggleLocked(thread)">
                        Lock thread
                    </a>
                </li>
            </ul>
        </div>
        <span v-if="thread.Stickied" class="thread-icon glyphicon glyphicon-bookmark"></span>
        <span v-if="thread.Locked" class="thread-icon glyphicon glyphicon-lock"></span>
        <a :title="thread.FirstPost.Text" :href="'Threads/View/' + thread.ID">{{ thread.Title }}</a>
        <a v-if="thread.Following" v-on:click.prevent="unfollow(thread)" href="#" title="Unfollow thread">
            <b class="unfollow-link glyphicon glyphicon-eye-close"></b>
        </a>
        <br>
        <span class="thread-info">
            <span v-if="thread.FirstPost.Anonymous || !thread.OP">Anonymous</span>
            <span v-else>{{ thread.OP.UserName }}</span>
            <br>
            Board: {{ thread.Tag.Name }} | Replies: {{ thread.PostCount - 1 }} | Last reply: <span class=time>{{ thread.LastPost.Time | date }}</span>
        </span>
    </div>
</div>

@section Scripts {
    <environment include="Development">
        <script src="~/js/threads.js" asp-append-version="true"></script>
        <script src="~/js/uploadfile.js" asp-append-version="true"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/js/threads.min.js" asp-append-version="true"></script>
    </environment>
}